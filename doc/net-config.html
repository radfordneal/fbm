<html>
<body>
<pre>
NET-CONFIG:  Specify weight configuration for a layer's connections

By default, units in one layer of a network are fully connected to
units in a layer that it feeds into.  Alternatively, for hidden
layers, what connections exist from the previous hidden layer or from
the input layer, and any sharing of weights between these connections,
can be specified in a configuration file, referenced from the
"input-config" or "hidden-config" flags in the network specification.
(See <A HREF="net-spec.html">net-spec.doc</A> for details.)

Configuration files can be written in various ways, as given by the
detailed syntax at the end of this document.  The simplest form, as a
sequence of source-destination-weight triples, is presented first
below, followed by increasingly elaborate forms.

This configuration file (which may be output from a command, if
specified with "%", see <A HREF="net-spec.html">net-spec.doc</A>) can contain one or more triples
of the form

    &lt;source-unit&gt; &lt;destination-unit&gt; &lt;weight-index&gt;

These elements may be positive integers. The source unit ranges from 1
to the number of units in the source layer (the input layer or the
previous hidden layer).  The destimation unit ranges from 1 to the
number of units in the hidden layer this configuration applies to.
The weight-index ranges from 1 to the number of weights used, which
may be less (or, unusally, more) than the number of connections, since
weights may be shared.

As an example, suppose the following network specification is used:

    net-spec log 2 3 input-config:conf 1 / ih=2 ho=3

and the file "conf" contains the following:

    1 1 1
    1 2 2
    2 1 2
    1 3 1  # The last one!

Note that the line breaks are not significant, but help readability.
A '#' causes the rest of the line to be ignored as a comment.

This network will have two parameters for input-to-hidden weights,
with the first parameter being used for the connections from the first
input to the first and third hidden unit, and the second parameter
being used for the connection from the first input to the second
hidden unit, and from the second input to the first hidden unit.

A connection from one unit to another may be associated with zero,
one, or more than one weight, with multiple weights having an additive
effect.  If no weight is associated with a connection, it is
effectivly absent from the network.

Indexes for units or weights may be specified relative to the values
in the previous triple, using the form +offset or -offset.  A "+" with
no offset is the same as "+1", and a "-" with no offset is the same as
"-1".  An index specifed as "=" is the same as the previous index.
The previous index is considered to be 0 at the start of the file.

For example, the following configuration file has the same effect as
the one above:

    + + 1
    = + +
    + -1 =
    1 +2 -

A number may also be written in parts separated by "+" or "-".  For
example, the last item above could be written as follows:

    7-6 +102-100 -

or as follows:

    1 +20+30-48 -10+9

A group of triples may be repeated by enclosing it in items of the
form "&lt;rep&gt;(" and ")", where &lt;rep&gt; is a positive integer (defaulting
to 1 if absent).  Such repeated groups may be nested.  A group of
triples enclosed by "&lt;rep&gt;[" and "]" will update the indexes used for
relative values, but without producing any connections.  A group of
triples enclosed by "&lt;rep&gt;{" and "}" will act like one encosed by
"&lt;rep&gt;(" and ")" except that, after all repetitions, the indexes used
for relative values will be restored to ther values before the repeat
group.

The utility of relative specifications specifications and grouping is
illustrated by the following network specification, which sets up a
network that computes a convolution of an input sequence of length 10
with a 3-point linear filter, which is then used in a logistic
regression model for binary classification:

    net-spec log 10 8 identity input-config:filter 1 / ih=1 ho=1 bo=1
    model-spec log binary

where the file "filter" contains

    1 1 1   + = +   + = +
    - + 1   + = +   + = +
    - + 1   + = +   + = +
    - + 1   + = +   + = +
    - + 1   + = +   + = +
    - + 1   + = +   + = +
    - + 1   + = +   + = +
    - + 1   + = +   + = +

Note that there are only three input-hidden weights in this model,
although there are 24 input-hidden connections in use, and 80 possible
input-hidden connections.

This configuration file can be abbreviated by using the repetition
facility, as follows:

    1 1 1   2( + = + )   7(  - + 1   2( + = + )  )

Using no-connection groups, this can be further abbreviated to

    [ 2 0 0 ]   8(  [ -2 + 0 ]   3( + = + )  )

Another way to specify the same configuration is as follows:

    8(  + + 1  2{  + = +  } )

Numbers may be specified using single-letter symbols, to which values
are assigned by items of the form &lt;letter&gt;=&lt;number&gt;.  For example, the
above may instead be written as

    R=8  s=3 
    R(  + + 1  s-1{  + = +  } )

Letters have the value zero before any assignment, and may be assigned
more than once - for example, a=3 a=a+1 is allowed, and leaves a with
the value 4.

The complete syntax for a configuration file can be written as
follows, with &lt;.&gt; for syntactic categories, | for alternatives, [.]
for optional parts, {.} for parts repeated zero or more times, and
double quotes for parts written literally:

    &lt;configuration&gt; : { &lt;part&gt; }

    &lt;part&gt;          : &lt;triple&gt; 
                    | [&lt;number&gt;]"(" { &lt;part&gt; } ")"
                    | [&lt;number&gt;]"{" { &lt;part&gt; } "}"
                    | [&lt;number&gt;]"[" { &lt;part&gt; } "]"
                    | &lt;letter&gt;=&lt;number&gt;

    &lt;triple&gt;        : &lt;index&gt; &lt;index&gt; &lt;index&gt;

    &lt;index&gt;         : &lt;number&gt; | &lt;sign&gt;[&lt;number&gt;]

    &lt;number&gt;        : &lt;term&gt;{&lt;sign&gt;&lt;term&gt;}

    &lt;term&gt;          : &lt;digits&gt; | &lt;letter&gt;

    &lt;digits&gt;        : &lt;digit&gt;{&lt;digit&gt;}

    &lt;digits&gt;        : "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"

    &lt;letter&gt;        : "a" | "b" | "c" | "d" | "e" | "f" | "g" | "h" | "i"
                    | "j" | "k" | "l" | "m" | "n" | "o" | "p" | "q" | "r"
                    | "s" | "t" | "u" | "v" | "w" | "x" | "y" | "z"
                    | "A" | "B" | "C" | "D" | "E" | "F" | "G" | "H" | "I"
                    | "J" | "K" | "L" | "M" | "N" | "O" | "P" | "Q" | "R"
                    | "S" | "T" | "U" | "V" | "W" | "X" | "Y" | "Z"

Whitespace above corresponds to whitespace (spaces or newlines) in the
file, and lack of whitespace above corresponds to no whitespace in the
file.  For example, a repeated triple must be written like 4( + + + ),
not like 4(+ + +) or 4 ( + + + ), and assignments must be written like
a=123, not like a = 123.

            Copyright (c) 2021 by Radford M. Neal
</pre>
</body>
</html>
