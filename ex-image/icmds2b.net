#!/bin/bash

# Commands to apply Bayesian neural network to an image classification problem.
# This version uses one hidden layer with convolutional connections.
#
# Four runs are done, each on three quarters of the training set, with
# the left-out quarters used to assess things like convergence.  Final
# testing is done on the cases not in the training set.

logb=ilog2b

for run in 1 2 3 4; do

  log=$logb.net$run
  end=`calc 400\*$run`
  start=`calc $end-399`

  net-spec $log 36 80 input-config:iconfig 4 \
                / ih=0.2:2 bh=0.3:2 ho=0.1:3::4 bo=0.1:2
  model-spec $log class
  
  data-spec $log 36 1 4 / idata-train@-$start:$end . idata-train@$start:$end .

  rand-seed $log $run
  
  net-gen $log fix 0.1$run

  mc-spec $log repeat 30 heatbath hybrid 100:10 0.12
  net-mc $log 1
  
  mc-spec $log repeat 15 \
             slevel 0.05 sample-sigmas heatbath 0.9 hybrid 200:20 0.22 negate \
             / leapfrog 8
  net-mc $log 6000 &

done

wait
  
./iend $logb 2001:
